# **P**ersonalized **R**eport **O**n **T**reatment and **E**legibility for **C**linical **T**rials (PROTECT)

PROTECT determines the clinical evidence applicable for a sample based on all genomic events that are flagged as being reportable.
PROTECT works exclusively on a clinical database generated by [SERVE](../serve/README.md) and uses a set of rules to match any type of 
evidence from SERVE against reportable genomic events.

## Contents
 - [How is evidence matched against genomic events?](#evidence-determination-per-type-of-genomic-event)
 - [When is evidence considered on-label?](#determining-whether-evidence-is-on-label-or-not)
 - [What evidence is considered relevant for reporting?](#evidence-consolidation-filtering-and-reporting)
 - [What output is produced by PROTECT?](#protect-output)

## Evidence determination per type of genomic event

Genomic events are categorized in five categories and evidence is matched for every category independently.

#### SNVs and (small) INDELs

For reportable small variants (SNVs and INDELs), the following matching is performed:
 - If the evidence is defined on the exact variant (hotspot) then evidence is always considered applicable
 - If the variant falls within the range in which the evidence is applicable then the evidence is applicable if the variant mutation type
 passes the filter defined as part of the evidence.
 - If a variant affects a gene for which evidence is applicable on a gene level (activation, inactivation, or any mutation), 
 then the evidence is considered applicable if the combination of variants affecting that gene have a high driver likelihood (> 80%).
 
Do note that germline and somatic variants are treated equally. It is not considered relevant for clinical evidence whether the variant is 
present in the germline already or has been acquired by the tumor somatically.   

#### Copy numbers

For copy numbers the matching is straightforward: evidence on amplifications and deletions is considered applicable in case a gene has been 
amplified or deleted. In addition to this matching, a deep deletion is assumed to inactivate a gene and hence evidence on gene 
inactivation is considered applicable in case of a deep deletion. 

#### Homozygous disruptions

When a gene has been homozygously disrupted, evidence is applicable when it has been defined on a gene level for which the event 
should be either inactivation or any mutation. 

#### Fusions

For fusions the following matching is performed:
 - Evidence defined on a promiscuous gene level is always considered applicable if a fusion with that gene is reported either in 5' or 3' 
 position.
 - Evidence that is applicable on an exact fusion pair has to match with the actual fusion pair, and also has to match the (optional) 
 exonic range defined as restriction on the evidence.

#### Signatures

Evidence on signatures is matched based on the interpretation of the algorithm producing the signature. For example, when CHORD suggests a
sample is HR deficient, any evidence for HR deficiency is considered applicable.

## Determining whether evidence is on-label or not

Evidence is considered on-label in case the evidence is defined for the tumor type of the sample that is evaluated, or for any tumor type
that is a parent of the sample tumor type. For example, evidence on solid tumors is considered applicable for a colorectal cancer sample 
since a solid tumor is a parent of colorectal cancer.

PROTECT uses DOID exclusively for matching and expects every evidence to be defined in terms of a single DOID entry. 

Some specific additional notes:
 - Since tumors could belong to multiple separate branches in the DOID tree, a tumor sample is allowed to have multiple DOIDs. 
 - The tumor sample DOIDs are optional. If they are not provided, all evidence is considered off-label (including evidence that is 
 applicable pan-cancer).

## Evidence consolidation, filtering and reporting

After evidence has been collected based on the five distinct categories op genomic mutations, and has been labeled as on-label or off-label,
evidence is consolidated and filtered down for reporting, using the following steps:
 1. Evidence is consolidated on source level. If the exact same evidence for the same event is found in multiple sources, this is 
 consolidated in a single instance of applicable evidence. PROTECT has no preference for any source, though sorts sources alphabetically 
 for consistency.
 1. There is some evidence that is never reported regardless of what event caused them or what their evidence level is. These are:
    - Evidence on TP53 is never reported.
    - Evidence for non-specific chemotherapy is never reported.
    - Evidence for aspirin is never reported.
    - Evidence for steroids is never reported. 
 1. Clinical trials are only reported when they are on-label. On-label for a trial in this context means: The patient is eligible for the 
 clinical trial. The treatment given in the clinical trial does not necessarily have to be on-label.
 1. For every event/treatment/direction combination only the highest level of evidence is reported:
    - Off-label evidence is only reported in case the evidence level is higher than the highest on-label evidence.
    
## PROTECT output

PROTECT produces a tsv with every applicable evidence after consolidation has been performed. 